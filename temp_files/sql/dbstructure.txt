https://dbdiagram.io/d

Table Roles{
roleID String [primary key]
roleName String
}

Table UserRoles{
  roleID String [primary key]
  userID String [primary key]
}


Table Users {
  userID String [primary key]
  created_at timestamp
  created_by String
  last_modified_at timestamp
  last_modified_by String
}

Table Groups {
  groupID String [primary key]
    group_name String
  created_at timestamp
  created_by String
  last_modified_at timestamp
  last_modified_by String
}

Table GroupUsers{
  userID String [primary key]
  groupID String [primary key]
}

Table Resource {
  resourcePath String [primary key]
  created_at timestamp
  created_by String
  last_modified_at timestamp
  last_modified_by String
}

Table GroupPermissions {
  groupID String [primary key]
  path String [primary key]
  type String
}

Table UserPermissions {
  userID String [primary key]
  path String [primary key]
  type String
}




Table AuditLog {
  logID integer [primary key]
  userID String
  action String  // Action type, e.g., 'grant', 'revoke'
  permissionID integer
  timestamp timestamp
  affected_userID String
  affected_groupID String
}

Table Permissions{
  permissionID String [primary key]
  weight int
}

Ref: Users.userID < UserRoles.userID
Ref: Roles.roleID < UserRoles.roleID

Ref: Users.userID < GroupUsers.userID
Ref: Groups.groupID < GroupUsers.groupID

Ref: Users.userID < UserPermissions.userID
Ref: Groups.groupID < GroupPermissions.groupID

Ref: Resource.resourcePath < UserPermissions.path
Ref: Resource.resourcePath < GroupPermissions.path



Ref: Permissions.permissionID < UserPermissions.type
Ref: Permissions.permissionID < GroupPermissions.type


CREATE TABLE Roles (
    roleID TEXT PRIMARY KEY,
    roleName TEXT
);

CREATE TABLE Users (
    userID TEXT PRIMARY KEY,
    created_at TIMESTAMP,
    created_by TEXT,
    last_modified_at TIMESTAMP,
    last_modified_by TEXT
);

CREATE TABLE UserRoles (
    roleID TEXT,
    userID TEXT,
    PRIMARY KEY (roleID, userID),
    FOREIGN KEY (roleID) REFERENCES Roles(roleID),
    FOREIGN KEY (userID) REFERENCES Users(userID)
);

CREATE TABLE Groups (
    groupID TEXT PRIMARY KEY,
    group_name TEXT,
    created_at TIMESTAMP,
    created_by TEXT,
    last_modified_at TIMESTAMP,
    last_modified_by TEXT
);

CREATE TABLE GroupUsers (
    userID TEXT,
    groupID TEXT,
    PRIMARY KEY (userID, groupID),
    FOREIGN KEY (userID) REFERENCES Users(userID),
    FOREIGN KEY (groupID) REFERENCES Groups(groupID)
);

CREATE TABLE Resource (
    resourcePath TEXT PRIMARY KEY,
    created_at TIMESTAMP,
    created_by TEXT,
    last_modified_at TIMESTAMP,
    last_modified_by TEXT
);

CREATE TABLE GroupPermissions (
    groupID TEXT,
    path TEXT,
    type TEXT,
    PRIMARY KEY (groupID, path),
    FOREIGN KEY (groupID) REFERENCES Groups(groupID),
    FOREIGN KEY (path) REFERENCES Resource(resourcePath)
);

CREATE TABLE UserPermissions (
    userID TEXT,
    path TEXT,
    type TEXT,
    PRIMARY KEY (userID, path),
    FOREIGN KEY (userID) REFERENCES Users(userID),
    FOREIGN KEY (path) REFERENCES Resource(resourcePath)
);

CREATE TABLE AuditLog (
    logID INTEGER PRIMARY KEY,
    userID TEXT,
    action TEXT, -- Action type, e.g., 'grant', 'revoke'
    permissionID TEXT,
    timestamp TIMESTAMP,
    affected_userID TEXT,
    affected_groupID TEXT,
    FOREIGN KEY (userID) REFERENCES Users(userID)
);

CREATE TABLE Permissions (
    permissionID TEXT PRIMARY KEY,
    weight INTEGER
);

ALTER TABLE UserPermissions ADD FOREIGN KEY (type) REFERENCES Permissions(permissionID);
ALTER TABLE GroupPermissions ADD FOREIGN KEY (type) REFERENCES Permissions(permissionID);



------Insert default data-----
INSERT OR IGNORE INTO ROLES(roleID, roleName) VALUES ('ROLE_ADMIN', 'Admin');
INSERT OR IGNORE INTO ROLES(roleID, roleName) VALUES ('ROLE_USER', 'User');

INSERT OR IGNORE INTO Permissions(PERMISSIONID, WEIGHT) VALUES ('DENY', 99);
INSERT OR IGNORE INTO Permissions(PERMISSIONID, WEIGHT) VALUES ('READ', 1);
INSERT OR IGNORE INTO Permissions(PERMISSIONID, WEIGHT) VALUES ('WRITE', 2);
INSERT OR IGNORE INTO Permissions(PERMISSIONID, WEIGHT) VALUES ('ADMIN', 4);